{% extends 'layouts/admin_base.html' %}

{% block title %}Change Password - adCTF{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 py-6">
    <!-- Breadcrumb -->
    <nav class="flex mb-6" aria-label="Breadcrumb">
        <ol class="inline-flex items-center space-x-1 md:space-x-3">
            <li class="inline-flex items-center">
                <a href="/admin" class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-blue-600">
                    <i class="fas fa-home mr-2"></i>Admin
                </a>
            </li>
            <li>
                <div class="flex items-center">
                    <i class="fas fa-chevron-right text-gray-400 mx-2"></i>
                    <span class="ml-1 text-sm font-medium text-gray-500">Change Password</span>
                </div>
            </li>
        </ol>
    </nav>

    <!-- Header -->
    <div class="text-center mb-8">
        <h1 class="text-4xl font-bold text-gray-800 mb-2">
            <i class="fas fa-key mr-3 text-blue-600"></i>Change Password
        </h1>
        <p class="text-lg text-gray-600">Update Your Admin Account Password</p>
    </div>
    
    {% include 'components/flash_messages.html' %}

    <!-- Password Change Form -->
    <div class="bg-white rounded-lg shadow-lg border border-gray-200 overflow-hidden">
        <div class="bg-gray-800 text-white px-6 py-4">
            <h5 class="text-lg font-semibold flex items-center">
                <i class="fas fa-shield-alt mr-2"></i>Security Settings
            </h5>
        </div>
        <div class="p-6">
            <form method="post" action="{{ url_for('change_password') }}" id="passwordForm">
                <div class="mb-6">
                    <label for="current_password" class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-lock mr-2"></i>Current Password
                    </label>
                    <input type="password" class="w-full px-4 py-3 border border-gray-300 rounded-lg text-lg focus:ring-blue-500 focus:border-blue-500" 
                           id="current_password" name="current_password" 
                           placeholder="Enter your current password" required>
                </div>
                
                <div class="mb-6">
                    <label for="new_password" class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-key mr-2"></i>New Password
                    </label>
                    <input type="password" class="w-full px-4 py-3 border border-gray-300 rounded-lg text-lg focus:ring-blue-500 focus:border-blue-500" 
                           id="new_password" name="new_password" 
                           placeholder="Enter your new password" required>
                    <div class="mt-2 text-sm text-gray-500">
                        <i class="fas fa-info-circle mr-1"></i>
                        Password should be at least 8 characters long.
                    </div>
                </div>
                
                <div class="mb-6">
                    <label for="confirm_password" class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-check-circle mr-2"></i>Confirm New Password
                    </label>
                    <input type="password" class="w-full px-4 py-3 border border-gray-300 rounded-lg text-lg focus:ring-blue-500 focus:border-blue-500" 
                           id="confirm_password" name="confirm_password" 
                           placeholder="Confirm your new password" required>
                </div>
                
                <div class="mb-6">
                    <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium text-lg transition-colors duration-200 flex items-center justify-center">
                        <i class="fas fa-save mr-2"></i>Change Password
                    </button>
                </div>
            </form>
        </div>
    </div>
    
</div>
{% endblock %}

{% block additional_scripts %}
<script>
$(document).ready(function() {
    $('#passwordForm').on('submit', function(e) {
        const newPassword = $('#new_password').val();
        const confirmPassword = $('#confirm_password').val();
        
        if (newPassword !== confirmPassword) {
            e.preventDefault();
            // Show SweetAlert error if available, otherwise fallback to alert
            if (typeof Swal !== 'undefined') {
                Swal.fire({
                    icon: 'error',
                    title: 'Password Mismatch!',
                    text: 'New password and confirmation do not match.',
                    timer: 3000
                });
            } else {
                alert('New password and confirmation do not match!');
            }
            return false;
        }
        
        if (newPassword.length < 8) {
            e.preventDefault();
            // Show SweetAlert error if available, otherwise fallback to alert
            if (typeof Swal !== 'undefined') {
                Swal.fire({
                    icon: 'error',
                    title: 'Password Too Short!',
                    text: 'Password must be at least 8 characters long.',
                    timer: 3000
                });
            } else {
                alert('Password must be at least 8 characters long!');
            }
            return false;
        }
        
        // Show loading state if SweetAlert is available
        if (typeof Swal !== 'undefined') {
            Swal.fire({
                title: 'Updating Password...',
                text: 'Please wait while we update your password.',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });
        }
    });
    
    // Add real-time password strength indicator
    $('#new_password').on('input', function() {
        const password = $(this).val();
        const strengthIndicator = $('#password-strength');
        
        if (strengthIndicator.length === 0) {
            $(this).after('<div id="password-strength" class="mt-2 text-sm"></div>');
        }
        
        let strength = 0;
        let message = '';
        let colorClass = '';
        
        if (password.length >= 8) strength++;
        if (password.match(/[a-z]/)) strength++;
        if (password.match(/[A-Z]/)) strength++;
        if (password.match(/[0-9]/)) strength++;
        if (password.match(/[^a-zA-Z0-9]/)) strength++;
        
        switch (strength) {
            case 0:
            case 1:
                message = 'Very Weak';
                colorClass = 'text-red-500';
                break;
            case 2:
                message = 'Weak';
                colorClass = 'text-orange-500';
                break;
            case 3:
                message = 'Fair';
                colorClass = 'text-yellow-500';
                break;
            case 4:
                message = 'Good';
                colorClass = 'text-blue-500';
                break;
            case 5:
                message = 'Strong';
                colorClass = 'text-green-500';
                break;
        }
        
        $('#password-strength').html(`<i class="fas fa-shield-alt mr-1"></i>Password Strength: <span class="${colorClass} font-medium">${message}</span>`);
    });
    
    // Clear strength indicator when input is empty
    $('#new_password').on('blur', function() {
        if ($(this).val() === '') {
            $('#password-strength').remove();
        }
    });
});
</script>
{% endblock %}
